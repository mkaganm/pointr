# Pointr API Tests Makefile (Windows PowerShell Compatible)
# KullanÄ±m: make [target]

.PHONY: help install setup test run clean

# Default target
help: ## Bu yardÄ±m mesajÄ±nÄ± gÃ¶ster
	@echo "Pointr API Tests - KullanÄ±labilir Komutlar:"
	@echo ""
	@echo "ğŸ“¦ Kurulum KomutlarÄ±:"
	@echo "  install     - BaÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kle"
	@echo "  setup       - Playwright ve gerekli araÃ§larÄ± kur"
	@echo ""
	@echo "ğŸ§ª Test KomutlarÄ±:"
	@echo "  test        - Sadece testleri Ã§alÄ±ÅŸtÄ±r"
	@echo "  run         - Test + Rapor + Serve (tek komutla her ÅŸeyi yap)"
	@echo ""
	@echo "ğŸ§¹ Temizlik KomutlarÄ±:"
	@echo "  clean       - Test sonuÃ§larÄ±nÄ± ve raporlarÄ± temizle"

# Kurulum komutlarÄ±
install: ## BaÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kle
	@echo "ğŸ“¦ BaÄŸÄ±mlÄ±lÄ±klar yÃ¼kleniyor..."
	npm install
	@echo "âœ… BaÄŸÄ±mlÄ±lÄ±klar yÃ¼klendi"

setup: ## Playwright ve gerekli araÃ§larÄ± kur
	@echo "ğŸ”§ Playwright kuruluyor..."
	npx playwright install --with-deps
	@echo "âœ… Playwright kuruldu"

# Test komutlarÄ±
test: ## Sadece testleri Ã§alÄ±ÅŸtÄ±r
	@echo "ğŸ§ª Testler Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."
	@if not defined PLAYWRIGHT_BASE_URL ( \
		echo "âš ï¸  PLAYWRIGHT_BASE_URL ayarlanmamÄ±ÅŸ, varsayÄ±lan: http://localhost:8081" && \
		set PLAYWRIGHT_BASE_URL=http://localhost:8081 \
	)
	npm run test:api
	@echo "âœ… Testler tamamlandÄ±"

# Ana komut - Test + Rapor + Serve
run: ## Test + Rapor + Serve (tek komutla her ÅŸeyi yap)
	@echo "ğŸš€ Test + Rapor + Serve baÅŸlatÄ±lÄ±yor..."
	@echo "âš ï¸  Mock API'nin Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun (http://localhost:8081)"
	@echo ""
	@echo "ğŸ“‹ AdÄ±mlar:"
	@echo "1. Testler Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."
	npm run test:api
	@echo ""
	@echo "2. Allure raporu oluÅŸturuluyor..."
	npm run report:allure
	@echo ""
	@echo "3. Rapor serve modunda aÃ§Ä±lÄ±yor..."
	@echo "âœ… Rapor http://localhost:8080 adresinde aÃ§Ä±lÄ±yor..."
	npx allure serve ./allure-results
	@echo "âœ… TÃ¼m iÅŸlemler tamamlandÄ±!"

# Temizlik komutlarÄ±
clean: ## Test sonuÃ§larÄ±nÄ± ve raporlarÄ± temizle
	@echo "ğŸ§¹ Temizlik yapÄ±lÄ±yor..."
	@if exist "allure-results" rmdir /s /q allure-results
	@if exist "allure-report" rmdir /s /q allure-report
	@if exist "playwright-report" rmdir /s /q playwright-report
	@if exist "test-results" rmdir /s /q test-results
	@echo "âœ… Temizlik tamamlandÄ±"
