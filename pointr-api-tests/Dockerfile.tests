FROM mcr.microsoft.com/playwright:v1.47.0-jammy

# Install Java for Allure CLI
RUN apt-get update && apt-get install -y openjdk-11-jdk && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Install node dependencies
COPY package.json package-lock.json* ./
RUN npm ci || npm i

# Install Playwright browsers and system deps
RUN npx playwright install --with-deps

# Copy project files
COPY . .

# Default envs (overridable by compose)
ENV PLAYWRIGHT_BASE_URL=http://api:8080
ENV ALLURE_RESULTS_DIR=/app/allure-results

# The actual test & report command is provided by docker-compose (tests service)
